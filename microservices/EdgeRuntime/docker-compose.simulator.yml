# Nokia 7750 SR BNG Simulator â€” High-Performance Go Edition
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.simulator.yml run --rm -T simulator
#
# Presets (via CLI args in command override):
#   --turbo    200ms cycle, 30s interim, 40 subs, burst 30, 8 conn/cyc
#   --fast     500ms cycle, 60s interim, 40 subs, burst 20, 5 conn/cyc  (default)
#   --gentle   5s cycle, 300s interim, 10 subs, burst 5, 1 conn/cyc
#
# Or override individual env vars:
#   docker compose ... run --rm -T -e CYCLE_MS=200 -e BURST_SIZE=30 simulator

services:
  simulator:
    build:
      context: ./scripts/nokia-bng-simulator
      dockerfile: Dockerfile
    container_name: ${COMPOSE_PROJECT_NAME:-edge}_simulator
    environment:
      RADIUS_HOST: freeradius
      RADIUS_AUTH_PORT: "1812"
      RADIUS_ACCT_PORT: "1813"
      RADIUS_SECRET: ${RADIUS_SECRET:-testing123}
      PG_CONN: "postgres://${POSTGRES_USER:-postgres}:${POSTGRES_PASSWORD:-changeme_in_production}@postgres:5432/${POSTGRES_DB:-edge_db}?sslmode=disable"
      MAX_SUBSCRIBERS: ${SIM_MAX_SUBSCRIBERS:-40}
      CYCLE_MS: ${SIM_CYCLE_MS:-500}
      INTERIM_INTERVAL: ${SIM_INTERIM_INTERVAL:-60}
      CONNECTS_PER_CYCLE: ${SIM_CONNECTS_PER_CYCLE:-5}
      BURST_SIZE: ${SIM_BURST_SIZE:-20}
      DISCONNECT_CHANCE: ${SIM_DISCONNECT_CHANCE:-5}
      HEADLESS: ${SIM_HEADLESS:-true}
    depends_on:
      freeradius:
        condition: service_started
      postgres:
        condition: service_healthy
    networks:
      - edge-network
    restart: "no"
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 256M
